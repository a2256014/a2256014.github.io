---
layout: post
title: Pwn Basic
subtitle: Pwnable 세팅 및 Pwngdb 단축키
author: g3rm
categories: 
banner:
  image: /assets/images/banners/home.gif
  opacity: 0.618
  background: "#000"
  heading_style: "font-size: 4.25em; font-weight: bold;"
  subheading_style: "color: gold"
tags:
  - Pwnable
  - Settings
  - Pwngdb
sidebar:
---

## Setting
```shell
Ubuntu 22.04
CTF용 우분투 세팅 (wsl)

sudo apt update -y
sudo apt install netcat vim git gcc ssh curl wget gdb sudo python3 python3-pip -y
sudo apt install libffi-dev build-essential libssl-dev libc6-i386 libc6-dbg gcc-multilib make tmux xterm -y
sudo dpkg --add-architecture i386
sudo apt update
sudo apt install libc6:i386 -y
python3 -m pip install --upgrade pip
pip3 install unicorn keystone-engine pwntools ropgadget
sudo apt install libcapstone-dev -y
cd ~
# git clone https://github.com/longld/peda.git ~/peda
# echo "source ~/peda/peda.py" >> ~/.gdbinit
# git clone https://github.com/scwuaptx/Pwngdb.git
# cp ~/Pwngdb/.gdbinit ~/
git clone https://github.com/pwndbg/pwndbg
cd pwndbg
./setup.sh
sudo apt install ruby-full -y
sudo gem install one_gadget seccomp-tools
```

## Pwngdb
```shell
# Entry point address:               0x10c0
readelf -h stack

# gdb 실행
cd "/mnt/c/wsl2/stack"
gdb stack

# 보호 기법 확인
pwngdb> checksec

# b breakpoint / c continue / r run / si step into / ni next instruction / i info / k kill/ pd pdisas
pwngdb> entry
pwngdb> b *main
pwngdb> c

# 어떤 함수의 내부까지 궁금할 때는 si를, 그렇지 않을 때는 ni
# next instruction
pwngdb> ni
pwngdb> si

# si 로 들어갔을 때 해당 함수 한번에 실행하여 나오기
pwngdb> finish

# disassembly
pwngdb> disassemble main
## 가독성 좋게 메모리 구조 표현해줌
pwngdb> u

# rsp 부터 80바이트를 8바이트 씩 hex형식으로 출력
pwngdb> x/20gx $rsp

# rip부터 5줄의 어셈블리 명령어 출력
pwngdb> x/5i $rip

# 특정 주소의 문자열 출력
pwngdb> x/s 0x40000

# 재귀적으로 메모리가 참조하고 있는 주소 탐색
pwngdb> tele

# 파일이 매핑 된 영역일 경우 해당 파일의 경로까지 보여줌
pwngdb> vmmap

# 입력값 전달
pwndbg> r $(python3 -c "print('\xff' * 100)")
pwndbg> r $(python3 -c "print('\xff' * 100)") <<< $(python3 -c "print('dreamhack')")
```

## Exploit
### Shellcode
> [shellcode database](https://shell-storm.org/shellcode/index.html)참고

스택이 실행가능한 영역이라면 사용할 수 있는 방법으로 최근에는 해당 공격 기법ㅇ
#### orw shellcode
파일을 열고 읽고 출력해주는 쉘코드로 아래 함수 정보를 이용하여 작성하면 된다.

| **syscall** | **rax** | **arg0 (rdi)**       | **arg1 (rsi)**  | **arg2 (rdx)** |
| ----------- | ------- | -------------------- | --------------- | -------------- |
| read        | 0x00    | unsigned int fd      | char *buf       | size_t count   |
| write       | 0x01    | unsigned int fd      | const char *buf | size_t count   |
| open        | 0x02    | const char *filename | int flags       | umode_t mode   |

### BOF
